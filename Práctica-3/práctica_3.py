import matplotlib.pyplot as plt
import multiprocessing
from math import ceil, sqrt
from time import time
import cv2 as cv2
import random
from scipy.stats import describe
import numpy as np
from tabulate import tabulate
######## variables##########
nucleos = multiprocessing.cpu_count()
noprimos = []

######## funcion primo #######
def primo(n):
    if n < 4:
        return True
    if n % 2 == 0:
        return False
    for i in range(3, int(ceil(sqrt(n))), 2):
        if n % i == 0:
             return False
    return True

############# obtencion de datos 3 variables #############
numprimos=[314606891,314606909,314606917,314606953,314606969,314606977,314607001,314607019,314607023,314607031,314607043,314607047,314607053,314607077,314607089,314607091,314607103,314607113,314607173,314607191,
           314607193,314607199,314607229,314607233,314607239,314607281,314607323,314607329,314607343,314607347,314607427,314607487,314607509,314607511,314607539,314607571,314607581,314607583,314607607,314607611,
           314607617,314607649,314607653,314607659,314607673,314607721,314607749,314607773,314607817,314607851,314607857,314607859,314607893,314607971,314607977,314607991,314608009,314608087,314608139,314608163,
           314608183,314608199,314608207,314608219,314608249,314608267,314608277,314608297,314608303,314608321,314608351,314608379,314608387,314608391,314608439,314608451,314608471,314608487,314608499,314608529,
           314608531,314608571,314608601,314608603,314608711,314608727,314608747,314608787,314608793,314608799,314608823,314608829,314608831,314608843,314608909,314608933,314608939,314608967,314608981,314608991,
           314608993,314608999,314609017,314609101,314609137,314609149,314609159,314609161,314609171,314609177,314609189,314609209,314609221,314609231,314609237,314609257,314609303,314609333,314609369,314609381,
           314609401,314609411,314609413,314609423,314609437,314609459,314609473,314609489,314609507,314609539,314609549,314609551,314609569,314609593,314609597,314609623,314609641,314609693,314609707,314609761,
           314609791,314609807,314609819,314609831,314609833,314609839,314609857,314609903,314609929,314609941,314609947,314609987,314609989,314610013,314610053,314610061,314610083,314610157,314610181,314610187,
           314610199,314610209,314610269,314610271,314610287,314610293,314610319,314610323,314610349,314610377,314610389,314610391,314610409,314610427,314610431,314610437,314610467,314610497,314610503,314610511,
           314610523,314610529,314610533,314610559,314610563,314610577,314610601,314610613,314610631,314610641,314610649,314610697,314610713,314610743,314610787,314610827,314610899,314610913,314610929,314610931,
           314610941,314610979,314610983,314610991,314611007,314611049,314611051,314611057,314611103,314611109,314611147,314611151,314611207,314611211,314611223,314611229,314611237,314611247,314611289,314611301,
           314611357,314611361,314611397,314611403,314611447,314611463,314611489,314611499,314611501,314611547,314611553,314611559,314611589,314611601,314611621,314611631,314611651,314611669,314611711,314611727,
           314611729,314611753,314611757,314611769,314611771,314611793,314611799,314611811,314611813,314611841,314611849,314611853,314611867,314611889,314611897,314611933,314611939,314611943,314611987,314612003,
           314612027,314612029,314612033,314612083,314612093,314612107,314612113,314612141,314612167,314612173,314612189,314612231,314612267,314612269,314612297,314612303,314612327,314612357,314612359,314612371,
           314612383,314612429,314612449,314612471,314612479,314612497,314612513,314612527,314612533,314612537,314612539,314612567,314612609,314612647,314612651,314612671,314612719,314612723,314612741,314612747,
           314612777,314612789,314612797,314612821,314612833,314612861,314612873,314612899,314612917,314612941,314612951,314612959,314612993,314613007,314613011,314613031,314613041,314613059,314613097,314613107,
           314613133,314613151,314613157,314613197,314613223,314613227,314613269,314613281,314613317,314613329,314613337,314613391,314613433,314613437,314613461,314613469,314613473,314613493,314613503,314613521,
           314613581,314613587,314613617,314613643,314613653,314613659,314613667,314613737,314613743,314613751,314613769,314613839,314613841,314613847,314613857,314613877,314613973,314613979,314613983,314613991,
           314614007,314614031,314614051,314614057,314614067,314614081,314614109,314614249,314614283,314614297,314614327,314614351,314614387,314614397,314614403,314614409,314614411,314614429,314614453,314614457,
           314614459,314614463,314614477,314614481,314614523,314614579,314614583,314614603,314614621,314614667,314614679,314614693,314614793,314614799,314614819,314614829,314614831,314614849,314614871,314614873,
           314614879,314614891,314614919,314614921,314614933,314614973,314614981,314614991,314615023,314615029,314615123,314615131,314615143,314615153,314615159,314615179,314615207,314615221,314615239,314615291,
           314615293,314615297,314615309,314615341,314615347,314615351,314615359,314615381,314615383,314615387,314615407,314615419,314615453,314615503,314615513,314615533,314615569,314615599,314615611,314615627,
           314615633,314615657,314615659,314615681,314615701,314615711,314615731,314615761,314615779,314615783,314615803,314615849,314615863,314615879,314615881,314615893,314615933,314615953,314615963,314615989,
           314616017,314616037,314616047,314616077,314616089,314616097,314616119,314616131,314616139,314616173,314616187,314616199,314616209,314616221,314616233,314616257,314616259,314616283,314616319,314616343,
           314616347,314616373,314616377,314616391,314616409,314616431,314616451,314616457,314616479,314616529,314616541,314616557,314616559,314616571,314616581,314616593,314616607,314616677,314616689,314616697,
           314616713,314616721,314616761,314616769,314616803,314616823,314616829,314616857,314616859,314616901,314616937,314616941,314616949,314616959,314616979,314616983,314616997,314617001,314617021,314617033,
           314617057,314617073,314617081,314617099,314617123,314617133,314617139,314617141,314617151,314617153,314617157,314617217,314617223,314617243,314617267,314617279,314617291,314617307,314617309,314617361,
           314617363,314617379,314617397,314617399,314617411,314617423,314617451,314617469,314617493,314617507,314617519,314617553,314617631,314617643,314617649,314617679,314617703,314617733,314617741,314617747,
           314617753,314617757,314617769,314617777,314617801,314617811,314617819,314617837,314617841,314617843,314617879,314617889,314617909,314617921,314617951,314617987,314617999,314618011,314618033,314618069,
           314618107,314618137,314618159,314618177,314618179,314618189,314618191,314618237,314618251,314618257,314618261,314618273,314618281,314618323,314618327,314618351,314618407,314618429,314618443,314618453,
           314618467,314618483,314618489,314618501,314618509,314618567,314618599,314618641,314618657,314618669,314618671,314618713,314618743,314618761,314618791,314618833,314618839,314618861,314618867,314618873,
           314618897,314618911,314618923,314618947,314619023,314619037,314619061,314619073,314619083,314619101,314619113,314619161,314619167,314619181,314619223,314619241,314619313,314619367,314619379,314619397,
           314619407,314619413,314619427,314619439,314619443,314619451,314619467,314619479,314619497,314619511,314619533,314619587,314619611,314619623,314619659,314619677,314619709,314619719,314619793,314619797,
           314619847,314619857,314619859,314619913,314619923,314619953,314619959,314620027,314620039,314620051,314620063,314620081,314620091,314620093,314620153,314620157,314620247,314620253,314620261,314620277,
           314620283,314620331,314620337,314620367,314620399,314620403,314620421,314620451,314620541,314620549,314620577,314620591,314620609,314620619,314620633,314620673,314620699,314620711,314620721,314620759,
           314620769,314620777,314620793,314620799,314620837,314620849,314620861,314620871,314620903,314620907,314620939,314621011,314621051,314621053,314621059,314621063,314621089,314621107,314621113,314621123,
           314621137,314621147,314621179,314621191,314621231,314621269,314621287,314621297,314621311,314621317,314621327,314621339,314621341,314621353,314621401,314621407,314621429,314621477,314621509,314621569,
           314621579,314621581,314621597,314621599,314621617,314621641,314621647,314621651,314621663,314621683,314621707,314621711,314621717,314621743,314621753,314621869,314621887,314621891,314621917,314621947,
           314621953,314621959,314621963,314621971,314621981,314621999,314622019,314622029,314622047,314622059,314622067,314622101,314622109,314622157,314622163,314622167,314622169,314622181,314622223,314622239,
           314622289,314622299,314622353,314622361,314622377,314622403,314622431,314622439,314622457,314622499,314622523,314622541,314622611,314622619,314622629,314622631,314622661,314622731,314622739,314622779,
           314622809,314622851,314622883,314622947,314622949,314622967,314622977,314622989,314622991,314623009,314623039,314623073,314623087,314623129,314623139,314623171,314623193,314623201,314623237,314623241,
           314623259,314623271,314623273,314623289,314623297,314623313,314623319,314623333,314623339,314623363,314623409,314623411,314623427,314623453,314623457,314623493,314623511,314623513,314623553,314623571,
           314623637,314623643,314623667,314623669,314623703,314623723,314623747,314623783,314623789,314623801,314623843,314623853,314623919,314623927,314623937,314623943,314623957,314623961,314623963,314623973,
           314623993,314624029,314624039,314624041,314624069,314624071,314624081,314624111,314624129,314624131,314624143,314624147,314624203,314624227,314624257,314624263,314624267,314624281,314624293,314624333,
           314624347,314624351,314624353,314624413,314624419,314624449,314624459,314624537,314624539,314624543,314624551,314624561,314624573,314624599,314624603,314624621,314624623,314624647,314624669,314624677,
           314624731,314624759,314624789,314624809,314624839,314624861,314624867,314624887,314624911,314624929,314624977,314624987,314625011,314625019,314625037,314625041,314625043,314625049,314625061,314625079,
           314625083,314625149,314625151,314625167,314625193,314625209,314625217,314625221,314625287,314625301,314625317,314625329,314625343,314625383,314625391,314625433,314625449,314625457,314625463,314625491,
           314625499,314625517,314625529,314625581,314625587,314625589,314625599,314625607,314625629,314625643,314625659,314625673,314625679,314625709,314625719,314625743,314625781,314625793,314625811,314625827,
           314625833,314625847,314625869,314625887,314625893,314625977,314625979,314625989,314625991,314626001,314626003,314626007,314626019,314626033,314626049,314626057,314626061,314626069,314626127,314626159,
           314626181,314626183,314626199,314626217,314626219,314626261,314626267,314626271,314626283,314626297,314626321,314626369,314626421,314626441,314626447,314626483,314626493,314626511,314626513,314626553,
           314626219,314626261,314626267,314626271,314626283,314626297,314626321,314626369,314626421,314626441,314626447,314626483,314626493,314626511,314626513,314626553,314626583,314626607,314626679,314626693,
           314626699,314626703,314626733,314626747,314626751,314626777,314626859,314626877,314626889,314626891,314626903,314626933,314626937,314626951,314626957,314626979,314626987,314626997,314627039,314627063,
           314627077,314627101,314627107,314627111,314627113,314627129,314627141,314627149,314627161,314627167,314627179,314627191,314627197,314627207,314627219,314627227,314627237,314627263,314627273,314627309,
           314627311,314627333,314627393,314627491,314627497,314627501,314627503,314627507,314627513,314627531,314627543,314627561,314627567,314627609,314627617,314627623,314627627,314627629,314627639,314627657,
           314627671,314627681,314627683,314627693,314627723,314627743,314627771,314627791,314627867,314627869,314627933,314627941,314627969,314628031,314628053,314628073,314628077,314628091,314628101,314628103,
           314628161,314628169,314628187,314628191,314628211,314628241,314628263,314628271,314628283,314628287,314628311,314628313,314628317,314628329,314628343,314628359,314628361,314628389,314628397,314628451,
           314628487,314628491,314628497,314628527,314628541,314628557,314628563,314628577,314628593,314628599,314628623,314628647,314628653,314628659,314628701,314628709,314628737,314628739,314628749,314628757,
           314628781,314628791,314628803,314628817,314628823,314628833,314628841,314628901,314628907,314628947,314628949,314628953,314628971,314628991,314628997,314629001,314629009,314629027,314629031,314629043,
           314629057,314629061,314629069,314629111,314629171,314629181,314629201,314629219,314629229,314629243,314629279,314629309,314629313,314629321,314629333,314629339,314629349,314629361,314629373,314629499,
           314629501,314629543,314629559,314629561,314629577,314629583,314629589,314629621,314629631,314629649,314629661,314629687,314629691,314629723,314629739,314629751,314629769,314629817,314629823,314629849,
           314629921,314629933,314629957,314629967,314629993,314630003,314630047,314630053,314630089,314630117,314630119,314630143,314630153,314630159,314630213,314630221,314630231,314630233,314630243,314630249,
           314630273,314630293,314630297,314630299,314630311,314630347,314630359,314630369,314630383,314630387,314630401,314630411,314630447,314630467,314630471,314630479,314630489,314630521,314630567,314630579,
           314630609,314630629,314630651,314630663,314630677,314630681,314630683,314630711,314630779,314630783,314630791,314630801,314630807,314630881,314630929,314630941,314630959,314630969,314630971,314631041,
           314631061,314631067,314631071,314631073,314631077,314631101,314631103,314631133,314631137,314631143,314631151,314631157,314631169,314631181,314631209,314631227,314631259,314631299,314631341,314631367,
           314631377,314631389,314631407,314631433,314631439,314631481,314631487,314631491,314631511,314631517,314631521,314631553,314631557,314631589,314631593,314631607,314631613,314631649,314631671,314631703,
           314631721,314631727,314631749,314631769,314631781,314631833,314631847,314631851,314631857,314631859,314631893,314631899,314631901,314631907,314631923,314631929,314631931,314631953,314631983,314632057,
           314632063,314632079,314632099,314632133,314632139,314632151,314632163,314632181,314632193,314632231,314632289,314632291,314632303,314632313,314632321,314632391,314632393,314632459,314632463,314632519,
           314632531,314632541,314632579,314632597,314632601,314632607,314632613,314632621,314632627,314632631,314632639,314632673,314632679,314632691,314632697,314632699,314632739,314632757,314632771,314632777,
           314632807,314632819,314632841,314632859,314632909,314632931,314632979,314632999,314633029,314633047,314633051,314633083,314633149,314633159,314633183,314633191,314633203,314633213,314633227,314633239,
           314633251,314633257,314633321,314633339,314633359,314633381,314633401,314633419,314633437,314633461,314633479,314633503,314633507,314633513,314633519,314633531,314633551,314633587,314633593,314633609,
           314633611,314633617,314633633,314633659,314633677,314633707,314633741,314633743,314633747,314633797,314633831,314633833,314633857,314633941,314633983,314633987,314633999,314634029,314634083,314634119,
           314634163,314634191,314634217,314634247,314634251,314634263,314634289,314634301,314634349,314634379,314634391,314634431,314634443,314634449,314634461,314634511,314634539,314634559,314634577,314634647,
           314634667,314634679,314634703,314634707,314634709,314634731,314634757,314634773,314634797,314634829,314634839,314634869,314634877,314634893,314634907,314634911,314634953,314634961,314634973,314635019,
           314635039,314635063,314635081,314635091,314635093,314635109,314635121,314635127,314635157,314635163,314635187,314635199,314635207,314635219,314635229,314635241,314635289,314635291,314635313,314635327,
           314635333,314635351,314635361,314635481,314635483,314635493,314635513,314635589,314635597,314635627,314635631,314635663,314635667,314635723,314635729,314635733,314635751,314635759,314635777,314635781]

########## ciclo para obtener lista de no primos ##########
for y in range (162):
    for z in range(numprimos[y]+1, numprimos[y+1]):
        if z%2 !=0:
            noprimos.append(z)
            
noprimos = noprimos[0:1500]

########## variables ###########
facil=noprimos+numprimos
dificil=numprimos+noprimos
mix=numprimos+noprimos
random.shuffle(mix)

############## analisis de tiempo en nucleos #############
#processes dice cuantos nucleos van a correr 7 maximo de preferencia
for s in range(1, 8):
    if __name__ == "__main__":
        replicas = 50
        tiemposF = []
        tiemposD = []
        tiemposM = []
        with multiprocessing.Pool(processes = nucleos-s) as pool:
            for r in range(replicas): # replicas
                ###### FACIL
                antes = time()
                primos = pool.map(primo, range(facil[0], facil[2999]))
                tiemposF.append(time() - antes)
                ###### DIFICIL
                antes2 = time()
                primos = pool.map(primo, range(dificil[0], dificil[2999]))
                tiemposD.append(time() - antes2)
                ###### MIXTO
                antes3 = time()
                primos = pool.map(primo, range(mix[0], mix[2999]))
                tiemposM.append(time() - antes3)
        
            d1 = tiemposF
            d2 = tiemposD
            d3 = tiemposM
            #print(describe(d1))
            #print(describe(d2))
            #print(describe(d3))
            Tabla1 = [["orden", "minimo", "maximo", "promedio", "media"],
                      ["facil", min(d1), max(d1), np.mean(d1), np.median(d1)],
                      ["dificil", min(d2), max(d2), np.mean(d2), np.median(d2)],
                      ["aleatorio", min(d3), max(d3), np.mean(d3), np.median(d3)]]
            print(tabulate(Tabla1))
            plt.boxplot([d1,d2,d3])
            plt.title('Caja-bigote')
            plt.xlabel('    Fácil                                Difícil                         Aleatorio')
            plt.ylabel('Tiempo de retraso(s)')
            plt.savefig('7_núcleos.png')
            plt.show()
            plt.close()
            

